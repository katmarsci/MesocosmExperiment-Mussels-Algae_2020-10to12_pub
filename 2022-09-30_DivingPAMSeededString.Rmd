---
title: "DivingPAM measurements on seeded string during mesocosm experiment 10-12/2020"
author: "Katrin Schertenleib"
date: "`r format(Sys.Date(), '%d/%m/%y')`"
output: github_notebook
---
file first created on Fri Sep 30 13:44:53 2022

aim: plot Fv/Fm, alpha, rETRmax, Ik

# 1. Housekeeping
libraries
```{r setup} 
#library(installr) #to always use the latest version
    #updateR()
#library(readxl)   #to import data from excel
library(yaml)     #for advanced Rmarkdown layout options, e.g. using code in the header (allows to print current date in Markdown header)
library(tidyverse)#includes ggplot, dplyr and plyr
#library(lubridate) #to run parse_date_time
#library(nortest) #to run Lilliefors corrected Kolmogorov-Smirnov normality tests
library(car) #to run Anova(). However, causes problem with dplyr recode()!
library(Hmisc) #to calculate stats for mean error plots in ggplot
```
note: If you have a code block named 'setup' like```{r setup} foo() ``` then every time you restart RStudio and execute any code in the middle of your markdown document, this block will be automatically run once before, i.e. you libraries will be loaded first.
foo() is a placeholder variable in coding

check work environment (especially, if you're not working in R projects)
```{r}
getwd() #when working in an R project, no need to change this manually. setwd() allows you to set it manually
#dir() #lists what is in the work directory
```


# 2. Reading in the data
```{r}
PAM.dat <- read_csv("2020-12-15_MesocosmExperiment_DivePAMSummary.csv") #Biofilm
```

# 3. Data preparation and exploration
check, if data was read in correctly
```{r}
spec(PAM.dat)
str(PAM.dat) #displays internal structure of the objects in the data frame
names(PAM.dat) #lists all variable headers in the data frame
nrow(PAM.dat) #gives you number of rows in the data frame

ncol(PAM.dat) #gives you number of columns in the data frame
head(PAM.dat) #good way to check the first 6 rows, i.e. see if not only the headers but also the data looks ok
tail(PAM.dat) #looks at the end of the data set
```

reduce data frame; separate the combined treatment information into additional columns for each factor
```{r}
PAM.dat <- PAM.dat[,c(4,7,13,15:17)]
PAM.dat <- separate(PAM.dat, treatment, sep = "_", into = c("SpeciesLevel", "TempLevel", "pCO2Level"), remove=FALSE)
PAM.dat <- PAM.dat[PAM.dat$SpeciesLevel=="KM" | PAM.dat$SpeciesLevel=="K",]
```


```{r}
summary(PAM.dat)
```
```{r}
table(PAM.dat$treatment)
```
calculate group means
```{r}
MeansFvoverFm <- round(tapply(PAM.dat$FvoverFm, interaction(PAM.dat$SpeciesLevel, PAM.dat$TempLevel, PAM.dat$pCO2Level), mean, na.rm=T),2)
Meansalpha <- round(tapply(PAM.dat$alpha, interaction(PAM.dat$SpeciesLevel, PAM.dat$TempLevel, PAM.dat$pCO2Level), mean, na.rm=T),2)
MeansrETRm <- round(tapply(PAM.dat$rETRm, interaction(PAM.dat$SpeciesLevel, PAM.dat$TempLevel, PAM.dat$pCO2Level), mean, na.rm=T),2)
MeansIk <- round(tapply(PAM.dat$Ik, interaction(PAM.dat$SpeciesLevel, PAM.dat$TempLevel, PAM.dat$pCO2Level), mean, na.rm=T),2)
VarIk <- round(tapply(PAM.dat$Ik, interaction(PAM.dat$SpeciesLevel, PAM.dat$TempLevel, PAM.dat$pCO2Level), var, na.rm=T),2)
```

MeansFvoverFm
  K.T+.C+  KM.T+.C+  K.T++.C+ KM.T++.C+   K.Ta.C+  KM.Ta.C+   K.T+.Ca  KM.T+.Ca  K.T++.Ca KM.T++.Ca   K.Ta.Ca  KM.Ta.Ca 
     0.82      0.80      0.71      0.79      0.72      0.80      0.80      0.79      0.72      0.75      0.73      0.72 
Means alpha
  K.T+.C+  KM.T+.C+  K.T++.C+ KM.T++.C+   K.Ta.C+  KM.Ta.C+   K.T+.Ca  KM.T+.Ca  K.T++.Ca KM.T++.Ca   K.Ta.Ca  KM.Ta.Ca 
     0.19      0.18      0.17      0.14      0.23      0.15      0.24      0.20      0.19      0.19      0.19      0.20 
Means rETRm
  K.T+.C+  KM.T+.C+  K.T++.C+ KM.T++.C+   K.Ta.C+  KM.Ta.C+   K.T+.Ca  KM.T+.Ca  K.T++.Ca KM.T++.Ca   K.Ta.Ca  KM.Ta.Ca 
    12.27     15.10     11.51     12.71     10.54     13.21     13.71     14.06     10.47     18.56     11.56     15.54 
Means Ik
  K.T+.C+  KM.T+.C+  K.T++.C+ KM.T++.C+   K.Ta.C+  KM.Ta.C+   K.T+.Ca  KM.T+.Ca  K.T++.Ca KM.T++.Ca   K.Ta.Ca  KM.Ta.Ca 
    65.01     88.44     75.46     94.45     47.20     91.41     56.32     71.70     56.15     97.07     61.50     80.91 
VarIk
  K.T+.C+  KM.T+.C+  K.T++.C+ KM.T++.C+   K.Ta.C+  KM.Ta.C+   K.T+.Ca  KM.T+.Ca  K.T++.Ca KM.T++.Ca   K.Ta.Ca  KM.Ta.Ca 
   650.73    379.48   1282.08    740.39    104.36    419.61    225.62    295.33    157.84    482.40    119.07    182.16


# 4. Plotting
```{r}
#to order the Temperature levels in an increasing way in the plot (lowest on bottom, highest on top)
PAM.dat$TempLevel <- factor(PAM.dat$TempLevel, levels = c("Ta", "T+", "T++")) #specify factor levels in the order you want
PAM.dat$pCO2Level <- factor(PAM.dat$pCO2Level, levels = c("Ca", "C+")) #specify factor levels in the order you want

#for better facet labeling I need to rename the levels of Assemblage:
PAM.dat_mod <- PAM.dat %>%    #requires tidyverse
  # Rename levels of Assemblage
  mutate(SpeciesLevel = dplyr::recode(SpeciesLevel, "B" = "Blank (B)", "K" = "Kelp (K)", "KM" = "Mussels and kelp (KM)", "M" = "Mussels only (M)"))

PAMKMK.dat <- PAM.dat[PAM.dat$SpeciesLevel=="KM" | PAM.dat$SpeciesLevel=="K",] #unless levels were removed above already

#for better facet labeling I need to rename the levels of Assemblage:
PAMKMK.dat_mod <- PAMKMK.dat %>%    #requires tidyverse
  # Rename levels of Assemblage
  mutate(SpeciesLevel = dplyr::recode(SpeciesLevel, "B" = "Blank (B)", "K" = "Kelp (K)", "KM" = "Mussels and kelp (KM)", "M" = "Mussels only (M)"))
```



```{r Fv/Fm plot}
FigureFvFm <- ggplot(PAMKMK.dat_mod, aes(x=TempLevel, y=FvoverFm, colour=TempLevel, fill=pCO2Level))  
FigureFvFm+
  geom_boxplot()+ #, lwd=0.7 width=0.6, position=position_dodge(0.5)
  facet_grid(.~SpeciesLevel)+
  labs(y="Maximum quantum yield (Fv/Fm)", x="Temperature Level")+ #labelling of axes (can be removed by setting to FALSE)
  scale_colour_manual(values = c("navy", "royalblue", "skyblue"))+ #manually select colours of "fill"
  scale_fill_manual(values=c("white","grey80"))+
  #scale_x_discrete(labels=c("5"= "Dec 08\n09:30", "6"= "Dec 08\n13:30", "7"= "Dec 08\n17:30", "8"= "Dec 09"))+
  #scale_y_continuous(breaks=seq(7,16,by=1))+
  theme(panel.background=element_blank(), #no background
        axis.line.x=element_line(colour="black", size= 0.5), #colour of the x- axis
        axis.line.y=element_line(colour="black", size= 0.5), #colour of the y- axis
        axis.ticks.x = element_line(), #x axis tick; to include and modify width use element_line(size = 0.8)
        axis.title.x=element_blank(),
        panel.grid=element_blank(), #no grid lines
        axis.text=element_text(size=9), #size of the numbers along the axes
        #axis.text.x=element_blank(), #x axis tick mark font specifications; include labels via element_text(size=10, angle=90, hjust=0, vjust=0.25); hjust and vjust are defined between 0(left-justified) and 1(right justified)
        axis.text.y=element_text(size=9),
        axis.title=element_text(size=9), #size of the labels on the axes
        #legend.position = c(0.9, 0.9),
        legend.text = element_text(size=9), #
        legend.title = element_text(size=9),
        #legend.position = c(0.92, 0.85),
        #legend.key=element_rect(fill="white"),
        #legend.background = element_rect(colour = "black")
        #strip.text = element_text(size = 9), #font size of facet labels
        #strip.background = element_blank() #removes facet label boxes
        #strip.background = element_rect(colour= "black", fill="grey97"))
        )+
  guides(fill = guide_legend(order = 2, title="pCO2 Level"), colour = guide_legend(order=1, title="Temperature \nLevel"))
```
```{r}
ggsave(path="Plots", filename="2022-09-30_DivingPAM_FvoverFm.png", width=7, height=3) #legend on figure
#ggsave(path="Plots", filename="SnapshotTemperatureMeasurements3.png", width=11, height=4)#legend right of figure
```

```{r alpha plot}
Figurealpha <- ggplot(PAMKMK.dat_mod, aes(x=TempLevel, y=alpha, colour=TempLevel, fill=pCO2Level))  
Figurealpha+
  geom_boxplot()+ #, lwd=0.7 width=0.6, position=position_dodge(0.5)
  facet_grid(.~SpeciesLevel)+
  labs(y="Initial slope of non-saturated photosynthetic rate (alpha)", x="Temperature Level")+ #labelling of axes (can be removed by setting to FALSE)
  scale_colour_manual(values = c("navy", "royalblue", "skyblue"))+ #manually select colours of "fill"
  scale_fill_manual(values=c("white","grey80"))+
  #scale_x_discrete(labels=c("5"= "Dec 08\n09:30", "6"= "Dec 08\n13:30", "7"= "Dec 08\n17:30", "8"= "Dec 09"))+
  #scale_y_continuous(breaks=seq(7,16,by=1))+
  theme(panel.background=element_blank(), #no background
        axis.line.x=element_line(colour="black", size= 0.5), #colour of the x- axis
        axis.line.y=element_line(colour="black", size= 0.5), #colour of the y- axis
        axis.ticks.x = element_line(), #x axis tick; to include and modify width use element_line(size = 0.8)
        axis.title.x=element_blank(),
        panel.grid=element_blank(), #no grid lines
        axis.text=element_text(size=9), #size of the numbers along the axes
        #axis.text.x=element_blank(), #x axis tick mark font specifications; include labels via element_text(size=10, angle=90, hjust=0, vjust=0.25); hjust and vjust are defined between 0(left-justified) and 1(right justified)
        axis.text.y=element_text(size=9),
        axis.title=element_text(size=9), #size of the labels on the axes
        #legend.position = c(0.9, 0.9),
        legend.text = element_text(size=9), #
        legend.title = element_text(size=9),
        #legend.position = c(0.92, 0.85),
        #legend.key=element_rect(fill="white"),
        #legend.background = element_rect(colour = "black")
        #strip.text = element_text(size = 9), #font size of facet labels
        #strip.background = element_blank() #removes facet label boxes
        #strip.background = element_rect(colour= "black", fill="grey97"))
        )+
  guides(fill = guide_legend(order = 2, title="pCO2 Level"), colour = guide_legend(order=1, title="Temperature \nLevel"))
```
```{r}
ggsave(path="Plots", filename="2022-09-30_DivingPAM_alpha.png", width=7, height=3) #legend on figure
#ggsave(path="Plots", filename="SnapshotTemperatureMeasurements3.png", width=11, height=4)#legend right of figure
```


```{r rETRm plot}
FigurerETRm <- ggplot(PAMKMK.dat_mod, aes(x=TempLevel, y=rETRm, colour=TempLevel, fill=pCO2Level))  
FigurerETRm+
  geom_boxplot()+ #, lwd=0.7 width=0.6, position=position_dodge(0.5)
  facet_grid(.~SpeciesLevel)+
  labs(y="Relative maximum electron transport rate (rETRm)", x="Temperature Level")+ #labelling of axes (can be removed by setting to FALSE)
  scale_colour_manual(values = c("navy", "royalblue", "skyblue"))+ #manually select colours of "fill"
  scale_fill_manual(values=c("white","grey80"))+
  #scale_x_discrete(labels=c("5"= "Dec 08\n09:30", "6"= "Dec 08\n13:30", "7"= "Dec 08\n17:30", "8"= "Dec 09"))+
  #scale_y_continuous(breaks=seq(7,16,by=1))+
  theme(panel.background=element_blank(), #no background
        axis.line.x=element_line(colour="black", size= 0.5), #colour of the x- axis
        axis.line.y=element_line(colour="black", size= 0.5), #colour of the y- axis
        axis.ticks.x = element_line(), #x axis tick; to include and modify width use element_line(size = 0.8)
        axis.title.x=element_blank(),
        panel.grid=element_blank(), #no grid lines
        axis.text=element_text(size=9), #size of the numbers along the axes
        #axis.text.x=element_blank(), #x axis tick mark font specifications; include labels via element_text(size=10, angle=90, hjust=0, vjust=0.25); hjust and vjust are defined between 0(left-justified) and 1(right justified)
        axis.text.y=element_text(size=9),
        axis.title=element_text(size=9), #size of the labels on the axes
        #legend.position = c(0.9, 0.9),
        legend.text = element_text(size=9), #
        legend.title = element_text(size=9),
        #legend.position = c(0.92, 0.85),
        #legend.key=element_rect(fill="white"),
        #legend.background = element_rect(colour = "black")
        #strip.text = element_text(size = 9), #font size of facet labels
        #strip.background = element_blank() #removes facet label boxes
        #strip.background = element_rect(colour= "black", fill="grey97"))
        )+
  guides(fill = guide_legend(order = 2, title="pCO2 Level"), colour = guide_legend(order=1, title="Temperature \nLevel"))
```

```{r}
ggsave(path="Plots", filename="2022-09-30_DivingPAM_rETRm.png", width=7, height=3) #legend on figure
#ggsave(path="Plots", filename="SnapshotTemperatureMeasurements3.png", width=11, height=4)#legend right of figure
```

```{r Ik plot}
FigurerIk <- ggplot(PAMKMK.dat_mod, aes(x=TempLevel, y=Ik, colour=TempLevel, fill=pCO2Level))  
FigurerIk+
  geom_boxplot()+ #, lwd=0.7 width=0.6, position=position_dodge(0.5)
  facet_grid(.~SpeciesLevel)+
  labs(y="Saturating light intensity (Ik)", x="Temperature Level")+ #labelling of axes (can be removed by setting to FALSE)
  scale_colour_manual(values = c("navy", "royalblue", "skyblue"))+ #manually select colours of "fill"
  scale_fill_manual(values=c("white","grey80"))+
  #scale_x_discrete(labels=c("5"= "Dec 08\n09:30", "6"= "Dec 08\n13:30", "7"= "Dec 08\n17:30", "8"= "Dec 09"))+
  #scale_y_continuous(breaks=seq(7,16,by=1))+
  theme(panel.background=element_blank(), #no background
        axis.line.x=element_line(colour="black", size= 0.5), #colour of the x- axis
        axis.line.y=element_line(colour="black", size= 0.5), #colour of the y- axis
        axis.ticks.x = element_line(), #x axis tick; to include and modify width use element_line(size = 0.8)
        axis.title.x=element_blank(),
        panel.grid=element_blank(), #no grid lines
        axis.text=element_text(size=9), #size of the numbers along the axes
        #axis.text.x=element_blank(), #x axis tick mark font specifications; include labels via element_text(size=10, angle=90, hjust=0, vjust=0.25); hjust and vjust are defined between 0(left-justified) and 1(right justified)
        axis.text.y=element_text(size=9),
        axis.title=element_text(size=9), #size of the labels on the axes
        #legend.position = c(0.9, 0.9),
        legend.text = element_text(size=9), #
        legend.title = element_text(size=9),
        #legend.position = c(0.92, 0.85),
        #legend.key=element_rect(fill="white"),
        #legend.background = element_rect(colour = "black")
        #strip.text = element_text(size = 9), #font size of facet labels
        #strip.background = element_blank() #removes facet label boxes
        #strip.background = element_rect(colour= "black", fill="grey97"))
        )+
  guides(fill = guide_legend(order = 2, title="pCO2 Level"), colour = guide_legend(order=1, title="Temperature \nLevel"))
```

```{r}
ggsave(path="Plots", filename="2022-11-01_DivingPAM_Ik_updated.png", width=7, height=3) #legend on figure
#ggsave(path="Plots", filename="SnapshotTemperatureMeasurements3.png", width=11, height=4)#legend right of figure
```



# 5. Statistical analyses
```{r}
names(PAM.dat)
```
```{r}
hist(PAM.dat$FvoverFm) #hm
hist(sqrt(PAM.dat$FvoverFm)) #hm
hist(log(PAM.dat$FvoverFm)) #hm
hist(PAM.dat$alpha) #hm
hist(sqrt(PAM.dat$alpha)) #no
hist(log(PAM.dat$alpha)) #no
hist(PAM.dat$rETRm) #hm
hist(sqrt(PAM.dat$rETRm)) #maybe
hist(log(PAM.dat$rETRm)) #hm
hist(scale(PAM.dat$rETRm))
hist(PAM.dat$Ik) #hm
hist(sqrt(PAM.dat$Ik)) #no
hist(log(PAM.dat$Ik)) #no
hist(log10(PAM.dat$Ik)) #no
hist(scale(PAM.dat$Ik)) #no
hist((PAM.dat$Ik)^2) #no
```

```{r}
table(PAM.dat$treatment)
```
# 5.1 Fv/Fm
raw (untransformed) data
```{r}
Model1r<-aov(PAM.dat$FvoverFm ~ PAM.dat$SpeciesLevel*PAM.dat$TempLevel*PAM.dat$pCO2Level) #Model1 multi-factorial; add +0.1 so that roots and logs make sense
```

```{r}
options(contrasts=c("contr.sum", "contr.poly"))
#Model simplification (do you do model simplification with ANOVAs?)
summary(Model1r) #main effects of temperature level significant (0.0363), rest insignificant
Anova(Model1r, type=3)

#Diagnostics for Model1
#homogeneity of variances
#graphical
plot(resid(Model1r)~fitted(Model1r))+
abline(h=0, lwd=2, col="black") #hm
#statistical
leveneTest(FvoverFm ~ SpeciesLevel*TempLevel*pCO2Level, data = PAM.dat) #requires library(car)
leveneTest(FvoverFm ~ TempLevel, data = PAM.dat) #requires library(car)
leveneTest(resid(Model1r) ~ TempLevel, data = PAM.dat) #requires library(car)

#normality of errors
#graphical
hist(resid(Model1r)) #hm
#statistical (Shapiro-Wilk test works for 7 < n < 70)
shapiro.test(resid(Model1r)) #insignificant, i.e. data normally distributed
#lillie.test(resid(Model1ru8))  # for n>70; requires library(nortest) #insignificant

#influential data points
plot(cooks.distance(Model1r),type="h") #all <1, i.e. not problematic

#autocorrelation (requires library(car))
durbinWatsonTest(Model1r) #DW statistic ranges from 0 to 4, with 2 indicating no autocorrelation. <2 is positively autocorrelated, >2 is negatively autocorrelated. Values in the range of 1.5 - 2.5 are considered "normal"
#ok
```
full model
                                                         Df Sum Sq  Mean Sq F value Pr(>F)  
PAM.dat$SpeciesLevel                                      1 0.0120 0.012042   1.602  0.212  
PAM.dat$TempLevel                                         2 0.0490 0.024516   3.261  0.047 *
PAM.dat$pCO2Level                                         1 0.0073 0.007304   0.972  0.329  
PAM.dat$SpeciesLevel:PAM.dat$TempLevel                    2 0.0157 0.007827   1.041  0.361  
PAM.dat$SpeciesLevel:PAM.dat$pCO2Level                    1 0.0084 0.008354   1.111  0.297  
PAM.dat$TempLevel:PAM.dat$pCO2Level                       2 0.0009 0.000472   0.063  0.939  
PAM.dat$SpeciesLevel:PAM.dat$TempLevel:PAM.dat$pCO2Level  2 0.0056 0.002800   0.372  0.691  
Residuals                                                48 0.3608 0.007517                 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

reduced model
                  Df Sum Sq  Mean Sq F value Pr(>F)  
PAM.dat$TempLevel  2 0.0490 0.024516   3.402 0.0402 *
Residuals         57 0.4107 0.007206



## 5.1.2 Retrospective power analysis
groups = number of factor levels
n = number of observations per sample
between.var = mean squares of the effect
within.var = mean squares of the residuals
sig.level = error rate (default is 0.05)
power = the power you want to achieve

NULL must be replaced by observed values. If you leave one of them as NULL,
this one will be calculated from the rest.

```{r}
power.anova.test(groups=12, n=5, between.var=0.024516, within.var=0.007206, sig.level=0.05, power=NULL) #high power (1)
```
strong power


## 5.1.3 Find differences - Post-hoc comparisons
include Bonferroni Correction to account for increased Type I error probability due to high number of comparisons
Tukey's test
```{r}
thsd1 <- TukeyHSD(Model1r)
plot(thsd1)
```
no significant difference found (apparently, this happens sometimes because post-hoc tests are less powerful than ANOVAs):
$`PAM.dat$TempLevel`
           diff         lwr         upr     p adj
T++-T+ -0.06145 -0.12775895 0.004858952 0.0744310
Ta-T+  -0.05980 -0.12610895 0.006508952 0.0847490
Ta-T++  0.00165 -0.06465895 0.067958952 0.9980053


# 5.2 alpha NO EFFECT
raw (untransformed) data
```{r}
Model1r<-aov(PAM.dat$alpha ~ PAM.dat$SpeciesLevel*PAM.dat$TempLevel*PAM.dat$pCO2Level) #Model1 multi-factorial; add +0.1 so that roots and logs make sense
```

```{r}
options(contrasts=c("contr.sum", "contr.poly"))
#Model simplification (do you do model simplification with ANOVAs?)
summary(Model1r) #main effects of temperature level significant (0.0363), rest insignificant
Anova(Model1r, type=3)


#Diagnostics for Model1
#homogeneity of variances
#graphical
plot(resid(Model1r)~fitted(Model1r))+
abline(h=0, lwd=2, col="black") #hm
#statistical
fligner.test(PAM.dat$alpha ~ PAM.dat$TempLevel) #insignificant, i.e. so variances can be assumed to be homogeneous
fligner.test(sqrt(PAM.dat$alpha) ~ PAM.dat$TempLevel) #insignificant
fligner.test(log(PAM.dat$alpha) ~ PAM.dat$TempLevel) #insignificant
fligner.test(PAM.dat$alpha ~ PAM.dat$SpeciesLevel) #not ok
fligner.test(PAM.dat$alpha ~ PAM.dat$pCO2Level) #ok
fligner.test(PAM.dat$alpha ~ interaction(PAM.dat$SpeciesLevel,  PAM.dat$TempLevel, PAM.dat$pCO2Level)) #ok
fligner.test(PAM.dat$alpha ~ interaction(PAM.dat$SpeciesLevel,  PAM.dat$TempLevel, PAM.dat$pCO2Level)) #ok
leveneTest(PAM.dat$alpha ~ MWWout.dat$SpeciesLevel*PAM.dat$TempLevel*PAM.dat$pCO2Level) #requires library(car)
leveneTest(resid(Model1r) ~ MWWout.dat$SpeciesLevel*PAM.dat$TempLevel*PAM.dat$pCO2Level)

#normality of errors
#graphical
hist(resid(Model1r)) #hm
#statistical (Shapiro-Wilk test works for 7 < n < 70)
shapiro.test(resid(Model1r)) #insignificant, i.e. data normally distributed
#lillie.test(resid(Model1ru8))  # for n>70; requires library(nortest) #insignificant

#influential data points
plot(cooks.distance(Model1r),type="h") #all <1, i.e. not problematic

#autocorrelation (requires library(car))
durbinWatsonTest(Model1r) #DW statistic ranges from 0 to 4, with 2 indicating no autocorrelation. <2 is positively autocorrelated, >2 is negatively autocorrelated. Values in the range of 1.5 - 2.5 are considered "normal"
#ok

#AIC(Model1r,Model1r)
#Model1u8 is better than Model1 (value is smaller)
```
NO EFFECT
                                                         Df  Sum Sq  Mean Sq F value Pr(>F)  
PAM.dat$SpeciesLevel                                      1 0.01035 0.010349   3.234 0.0784 .
PAM.dat$TempLevel                                         2 0.00896 0.004480   1.400 0.2566  
PAM.dat$pCO2Level                                         1 0.00893 0.008930   2.790 0.1013  
PAM.dat$SpeciesLevel:PAM.dat$TempLevel                    2 0.00153 0.000763   0.239 0.7887  
PAM.dat$SpeciesLevel:PAM.dat$pCO2Level                    1 0.00397 0.003969   1.240 0.2710  
PAM.dat$TempLevel:PAM.dat$pCO2Level                       2 0.00283 0.001415   0.442 0.6454  
PAM.dat$SpeciesLevel:PAM.dat$TempLevel:PAM.dat$pCO2Level  2 0.00828 0.004139   1.293 0.2838  
Residuals                                                48 0.15362 0.003200                 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

# 5.3 rETRmax
untransformed data has non-normal errors, sqrt transformation, too
```{r}
summary(PAM.dat$rETRm)
Model1<-aov(log(PAM.dat$rETRm) ~ PAM.dat$SpeciesLevel*PAM.dat$TempLevel*PAM.dat$pCO2Level) #Model1 multi-factorial; add +0.1 so that roots and logs make sense
```


```{r}
options(contrasts=c("contr.sum", "contr.poly"))
#Model simplification (do you do model simplification with ANOVAs?)
summary(Model1) #main effects of temperature level significant (0.0363), Temp*Species marginally significant, rest insignificant
Anova(Model1)

Anova(Model1, type=3)


#Diagnostics for Model1
#homogeneity of variances
#graphical
plot(resid(Model1)~fitted(Model1))+
abline(h=0, lwd=2, col="black") #hm
#statistical
leveneTest(PAM.dat$rETRm ~ PAM.dat$SpeciesLevel*PAM.dat$TempLevel*PAM.dat$pCO2Level) #requires library(car)
leveneTest(resid(Model1) ~ PAM.dat$SpeciesLevel*PAM.dat$TempLevel*PAM.dat$pCO2Level)

#normality of errors
#graphical
hist(resid(Model1)) #ok
#statistical (Shapiro-Wilk test works for 7 < n < 70)
shapiro.test(resid(Model1)) #insignificant, i.e. errors normally distributed
#lillie.test(resid(Model1u8))  # for n>70; requires library(nortest) #insignificant

#influential data points
plot(cooks.distance(Model1),type="h") #all <1, i.e. not problematic

#autocorrelation (requires library(car))
durbinWatsonTest(Model1) #DW statistic ranges from 0 to 4, with 2 indicating no autocorrelation. <2 is positively autocorrelated, >2 is negatively autocorrelated. Values in the range of 1.5 - 2.5 are considered "normal"
#ok
```
                                                         Df Sum Sq Mean Sq F value  Pr(>F)   
PAM.dat$SpeciesLevel                                      1  0.897  0.8971  10.107 0.00259 **
PAM.dat$TempLevel                                         2  0.057  0.0287   0.324 0.72494   
PAM.dat$pCO2Level                                         1  0.189  0.1891   2.130 0.15091   
PAM.dat$SpeciesLevel:PAM.dat$TempLevel                    2  0.106  0.0532   0.599 0.55336   
PAM.dat$SpeciesLevel:PAM.dat$pCO2Level                    1  0.025  0.0250   0.282 0.59785   
PAM.dat$TempLevel:PAM.dat$pCO2Level                       2  0.041  0.0205   0.231 0.79478   
PAM.dat$SpeciesLevel:PAM.dat$TempLevel:PAM.dat$pCO2Level  2  0.170  0.0849   0.956 0.39150   
Residuals                                                48  4.261  0.0888                   
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

                     Df Sum Sq Mean Sq F value  Pr(>F)   
PAM.dat$SpeciesLevel  1  0.897  0.8971   10.73 0.00178 **
Residuals            58  4.849  0.0836  

## 5.3.2 Retrospective power analysis
groups = number of factor levels
n = number of observations per sample
between.var = mean squares of the effect
within.var = mean squares of the residuals
sig.level = error rate (default is 0.05)
power = the power you want to achieve

NULL must be replaced by observed values. If you leave one of them as NULL,
this one will be calculated from the rest.

```{r}
power.anova.test(groups=12, n=5, between.var= 0.8971, within.var=0.0836, sig.level=0.05, power=NULL) #high power (1)
```
strong power

## 5.3.3 Find differences - Post-hoc comparisons
include Bonferroni Correction to account for increased Type I error probability due to high number of comparisons
Tukey's test
```{r}
thsd1 <- TukeyHSD(Model1u8)
plot(thsd1)
```
 Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = log(PAM.dat$rETRm) ~ PAM.dat$SpeciesLevel, data = PAM.dat)

$`PAM.dat$SpeciesLevel`
          diff        lwr       upr     p adj
KM-K 0.2445527 0.09510723 0.3939981 0.0017821


# 5.4 saturating light intensity
raw (untransformed) data NON-NORMAL ERRORS
```{r}
summary(PAM.dat$Ik)
Model1<-aov(log(PAM.dat$Ik) ~ PAM.dat$SpeciesLevel*PAM.dat$TempLevel*PAM.dat$pCO2Level) #Model1 multi-factorial; add +0.1 so that roots and logs make sense
```


```{r}
options(contrasts=c("contr.sum", "contr.poly"))
#Model simplification (do you do model simplification with ANOVAs?)
summary(Model1) #main effects of temperature level significant (0.0363), Temp*Species marginally significant, rest insignificant
Anova(Model1, type=3)


#Diagnostics for Model1
#homogeneity of variances
#graphical
plot(resid(Model1)~fitted(Model1))+
abline(h=0, lwd=2, col="black") #hm
#statistical
leveneTest(resid(Model1) ~ SpeciesLevel, data = PAM.dat) #requires library(car) OK
leveneTest(Ik ~ SpeciesLevel, data = PAM.dat) #requires library(car) OK 
leveneTest(Ik ~ SpeciesLevel*TempLevel*pCO2Level, data = PAM.dat) #requires library(car) OK
leveneTest(resid(Model1) ~ SpeciesLevel*TempLevel*pCO2Level, data = PAM.dat) #requires library(car) OK

#normality of errors
#graphical
hist(resid(Model1)) #ok
#statistical (Shapiro-Wilk test works for 7 < n < 70)
shapiro.test(resid(Model1)) #insignificant, i.e. errors not normally distributed
#lillie.test(resid(Model1u8))  # for n>70; requires library(nortest) #insignificant

#influential data points
plot(cooks.distance(Model1),type="h") #all <1, i.e. not problematic

#autocorrelation (requires library(car))
durbinWatsonTest(Model1) #DW statistic ranges from 0 to 4, with 2 indicating no autocorrelation. <2 is positively autocorrelated, >2 is negatively autocorrelated. Values in the range of 1.5 - 2.5 are considered "normal"
#ok

AIC(Model1,Model1u8)
#Model1u7 is better than Model1 (value is smaller)
```
                                                         Df Sum Sq Mean Sq F value   Pr(>F)    
PAM.dat$SpeciesLevel                                      1  2.313  2.3135  31.966 8.43e-07 ***
PAM.dat$TempLevel                                         2  0.211  0.1056   1.459    0.243    
PAM.dat$pCO2Level                                         1  0.056  0.0560   0.774    0.383    
PAM.dat$SpeciesLevel:PAM.dat$TempLevel                    2  0.077  0.0386   0.534    0.590    
PAM.dat$SpeciesLevel:PAM.dat$pCO2Level                    1  0.022  0.0222   0.307    0.582    
PAM.dat$TempLevel:PAM.dat$pCO2Level                       2  0.154  0.0769   1.062    0.354    
PAM.dat$SpeciesLevel:PAM.dat$TempLevel:PAM.dat$pCO2Level  2  0.267  0.1333   1.841    0.170    
Residuals                                                48  3.474  0.0724                     
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

                     Df Sum Sq Mean Sq F value   Pr(>F)    
PAM.dat$SpeciesLevel  1  2.313  2.3135   31.49 5.89e-07 ***
Residuals            58  4.261  0.0735                     
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

# 6. Summary statistics


# 7 Plotting significant effects
```{r}
#for better facet labeling I need to rename the levels of SpeciesLevel:
PAM.dat_mod2 <- PAM.dat %>%    #requires tidyverse
  # Rename levels of SpeciesLevel
  mutate(SpeciesLevel = dplyr::recode(SpeciesLevel, "KM" = "Mussels and algae", "M" = "Mussels only", "K" = "Algae only"),
         pCO2Level = dplyr::recode(pCO2Level, "C+" = "650 ppm", "Ca" = "450 ppm (ambient)"),
         TempLevel = dplyr::recode(TempLevel, "T++" = "+2°C", "T+" = "+1°C", "Ta" = "ambient \n(9 - 12°C)"),
         treatment = dplyr::recode(treatment, "KM_Ta_Ca"="MA_Ta_Ca", "KM_Ta_C+"="MA_Ta_C+", "KM_T+_Ca"="MA_T+_Ca", "KM_T+_C+"="MA_T+_C+", "KM_T++_Ca"="MA_T++_Ca", "KM_T++_C+"="MA_T++_C+"))

#to place Mussels only first in the order of the SpeciesLevel levels
PAM.dat_mod2$SpeciesLevel <- factor(PAM.dat_mod2$SpeciesLevel, levels = c("Mussels only", "Mussels and algae", "Algae only")) #specify factor levels in the order you want

#to order the pCO2 levels in an increasing way
PAM.dat_mod2$pCO2Level <- factor(PAM.dat_mod2$pCO2Level, levels = c("450 ppm (ambient)", "650 ppm")) #specify factor levels in the order you want

#to order the Temperature levels in an increasing way
PAM.dat_mod2$TempLevel <- factor(PAM.dat_mod2$TempLevel, levels = c("ambient \n(9 - 12°C)", "+1°C", "+2°C")) #specify factor levels in the order you want

#to order the combined Treatment levels in an increasing way
PAM.dat_mod2$treatment <- factor(PAM.dat_mod2$treatment, levels = c("MA_Ta_Ca", "MA_Ta_C+", "MA_T+_Ca", "MA_T+_C+", "MA_T++_Ca", "MA_T++_C+", "M_Ta_Ca", "M_Ta_C+", "M_T+_Ca", "M_T+_C+", "M_T++_Ca", "M_T++_C+")) #specify factor levels in the order you want
```
## 7.1 Fv/Fm
```{r Fv/Fm all data}
FigFvFmmmeall<-ggplot(PAM.dat_mod2, aes(x=TempLevel, y=FvoverFm, colour=TempLevel, fill=pCO2Level)) # colour needs to be character , colour=TempLevel, fill=TempLevel , fill=SpeciesLevel
FigFvFmmmeall+
  facet_wrap(.~SpeciesLevel, scales="free_x")+ #, strip.position = "bottom"
  stat_summary(fun=mean, geom="bar", width=0.8, linewidth=1.3, position="dodge")+ # Layer 2: Plot the means as bars , colour="white"  NOTE: requires library(Hmisc) linewidth=0.7,size=10, , colour="black" , fill= "grey70" , fill=c("grey75", "grey50")
  stat_summary(fun.data=mean_se, geom="errorbar", position=position_dodge(width=0.8), width=0.0, colour="black", linetype=1, linewidth=0.8)+# Layer 3: Add CIs as error bars using mean_cl_normal as fun.data 
  scale_y_continuous(breaks=seq(0,0.8,by=0.25))+
  scale_colour_manual(values = c("skyblue", "royalblue", "blue3"))+ 
  scale_fill_manual(values = c("white", "grey80"))+  #, labels = expression("...", "...") 
  labs(x="Temperature level", y="Fv/Fm")+ #labeling of axes
  theme(panel.background=element_blank(), #no background
        axis.line.x=element_line(colour="black"), #colour of the x- axis; size= 0.8
        axis.line.y=element_line(colour="black"), #colour of the y- axis; size= 0.8
        axis.ticks.x = element_line(size=0.8), #x axis tick; to include and modify width use element_line(size = 0.8)
        #axis.ticks.length=unit(),#.25, "cm"
        panel.grid=element_blank(), #no grid lines
        axis.text.x=element_text(size=12, colour="black"), #for size of the numbers along the axes; include labels via element_text(size=10, angle=90, hjust=0, vjust=0.25); hjust and vjust are defined between 0(left-justified) and 1(right justified)
        axis.text.y=element_text(size=12, colour="black"),
        axis.title=element_text(size=12),#size of the labels on the axes 
        #axis.title.y=element_text(size=12),#size of the labels on the axes
        #axis.title.x=element_blank(),
        #legend.position = c(0.9, 0.9),
        legend.text = element_text(size=12), #
        #legend.title = element_text(),
        strip.text = element_text(size = 12), #font size of facet labels
        strip.background = element_blank() #removes facet label boxes
        )+
  guides(colour = "none", fill = "none")+ #guide_legend(order = 2, title="Temperature")+
  annotate("text", x=1, y=0.8, label= " ") 
```
```{r}
ggsave(path="Plots", filename="2023-01-29_FvFm_mean-errorSE_all-data.png", width=7, height=4)#width=7 or 5
```

```{r temperature main effect}
FigFvFmmetemp<-ggplot(PAM.dat_mod2 , aes(x=TempLevel, y=FvoverFm, colour=TempLevel, fill=TempLevel)) # colour needs to be character , colour=TempLevel, fill=TempLevel , fill=SpeciesLevel
FigFvFmmetemp+
  #facet_wrap(.~SpeciesLevel, scales="free_x")+ #, strip.position = "bottom"
  stat_summary(fun=mean, geom="bar", width=0.8)+ # Layer 2: Plot the means as bars , colour="white"  NOTE: requires library(Hmisc) linewidth=0.7,size=10, , colour="black" , fill= "grey70" , fill=c("grey75", "grey50")
  stat_summary(fun.data=mean_se, geom="errorbar", position=position_dodge(width=0.9), width=0.0, colour="black", linetype=1, linewidth=0.8)+# Layer 3: Add CIs as error bars using mean_cl_normal as fun.data
  scale_y_continuous(breaks=seq(0,0.8,by=0.25))+
  scale_colour_manual(values = c("skyblue", "royalblue", "blue3"))+ 
  scale_fill_manual(values = c("skyblue", "royalblue", "blue3"))+  #, labels = expression("...", "...") 
  labs(x="Temperature level", y="Fv/Fm")+ #labeling of axes x="none", 
  theme(panel.background=element_blank(), #no background
        axis.line.x=element_line(colour="black"), #colour of the x- axis; size= 0.8
        axis.line.y=element_line(colour="black"), #colour of the y- axis; size= 0.8
        axis.ticks = element_line(colour="black", size=0.8), #x axis tick; to include and modify width use element_line(size = 0.8)
        #axis.ticks.length=unit(),#.25, "cm"
        panel.grid=element_blank(), #no grid lines
        axis.text.x=element_text(size=12, colour="black"),#text(size=12), #for size of the numbers along the axes; include labels via element_text(size=10, angle=90, hjust=0, vjust=0.25); hjust and vjust are defined between 0(left-justified) and 1(right justified)
        axis.text.y=element_text(size=12, colour="black"),
        axis.title=element_text(size=12),#text(size=12),#size of the labels on the axes 
        #axis.title.y=element_text(size=12),#size of the labels on the axes
       # axis.title.x=element_blank(),
        #legend.position = c(0.9, 0.9),
        legend.text = element_text(size=12), #
        #legend.title = element_text(),
        strip.text = element_text(size = 12), #font size of facet labels
        strip.background = element_blank() #removes facet label boxes
        )+
  guides(colour = "none", fill = "none")
  annotate("text", x=1, y=0.13, label= " ")
```

```{r}
ggsave(path="Plots", filename="2023-01-29_FvFm_mean-errorSE_temp-main-effect.png", width=3, height=3.5)#width=7 or 5
```

```{r}
tapply(PAM.dat_mod2$FvoverFm, PAM.dat_mod2$TempLevel, mean)
```
## 7.2 rETRm
```{r rETR all data}
FigrETRmmeall<-ggplot(PAM.dat_mod2, aes(x=TempLevel, y=rETRm, colour=TempLevel, fill=pCO2Level)) # colour needs to be character , colour=TempLevel, fill=TempLevel , fill=SpeciesLevel
FigrETRmmeall+
  facet_wrap(.~SpeciesLevel, scales="free_x")+ #, strip.position = "bottom"
  stat_summary(fun=mean, geom="bar", width=0.8, linewidth=1.3, position="dodge")+ # Layer 2: Plot the means as bars , colour="white"  NOTE: requires library(Hmisc) linewidth=0.7,size=10, , colour="black" , fill= "grey70" , fill=c("grey75", "grey50")
  stat_summary(fun.data=mean_se, geom="errorbar", position=position_dodge(width=0.8), width=0.0, colour="black", linetype=1, linewidth=0.8)+# Layer 3: Add CIs as error bars using mean_cl_normal as fun.data 
  scale_y_continuous(breaks=seq(0,20,by=5))+
  scale_colour_manual(values = c("skyblue", "royalblue", "blue3"))+ 
  scale_fill_manual(values = c("white", "grey80"))+  #, labels = expression("...", "...") 
  labs(x="Temperature level", y="rETRmax")+ #labeling of axes
  theme(panel.background=element_blank(), #no background
        axis.line.x=element_line(colour="black"), #colour of the x- axis; size= 0.8
        axis.line.y=element_line(colour="black"), #colour of the y- axis; size= 0.8
        axis.ticks.x = element_line(size=0.8), #x axis tick; to include and modify width use element_line(size = 0.8)
        #axis.ticks.length=unit(),#.25, "cm"
        panel.grid=element_blank(), #no grid lines
        axis.text.x=element_text(size=12, colour="black"), #for size of the numbers along the axes; include labels via element_text(size=10, angle=90, hjust=0, vjust=0.25); hjust and vjust are defined between 0(left-justified) and 1(right justified)
        axis.text.y=element_text(size=12, colour="black"),
        axis.title=element_text(size=12),#size of the labels on the axes 
        #axis.title.y=element_text(size=12),#size of the labels on the axes
        #axis.title.x=element_blank(),
        #legend.position = c(0.9, 0.9),
        legend.text = element_text(size=12), #
        #legend.title = element_text(),
        strip.text = element_text(size = 12), #font size of facet labels
        strip.background = element_blank() #removes facet label boxes
        )+
  guides(colour = "none", fill = "none")+ #guide_legend(order = 2, title="Temperature")+
  annotate("text", x=1, y=28, label= " ") 
```
```{r}
ggsave(path="Plots", filename="2023-01-27_rETRm_mean-errorSE_all-data1.png", width=7, height=4)#width=7 or 5
```

```{r species main effect}
#to order the Temperature levels in an increasing way
#PAM.dat_mod2$TempLevel <- factor(PAM.dat_mod2$TempLevel, levels = c("ambient +2°C", "ambient +1°C", "ambient (9 - 12°C)")) #specify factor levels in the order you want

FigrETRmme<-ggplot(PAM.dat_mod2, aes(x=SpeciesLevel, y=rETRm)) # colour needs to be character , colour=TempLevel, fill=TempLevel , fill=SpeciesLevel
FigrETRmme+
  #facet_wrap(.~SpeciesLevel, scales="free_x")+ #, strip.position = "bottom"
  stat_summary(fun=mean, geom="bar", width=0.8, linewidth=1, position="dodge", colour="black", fill="white")+ # Layer 2: Plot the means as bars , colour="white"  NOTE: requires library(Hmisc)
  stat_summary(fun.data=mean_se, geom="errorbar", position=position_dodge(width=0.9), width=0.0, colour="black", linetype=1, linewidth=0.8)+# Layer 3: Add CIs as error bars using mean_cl_normal as fun.data
  #scale_colour_manual(values = c("skyblue", "royalblue", "blue3"))+ 
  #scale_fill_manual(values = c("grey70", "grey90"))+  #, labels = expression("...", "...") 
  labs(x="none", y="none")+ #labeling of axes
  #scale_y_continuous(breaks=seq(0,1.9,by=0.5))+
  theme(panel.background=element_blank(), #no background
        axis.line.x=element_line(colour="black"), #colour of the x- axis; size= 0.8
        axis.line.y=element_line(colour="black"), #colour of the y- axis; size= 0.8
        axis.ticks.x = element_blank(), #x axis tick; to include and modify width use element_line(size = 0.8)
        #axis.ticks.length=unit(),#.25, "cm"
        panel.grid=element_blank(), #no grid lines
        axis.text.x=element_blank(),#text(size=12), #for size of the numbers along the axes; include labels via element_text(size=10, angle=90, hjust=0, vjust=0.25); hjust and vjust are defined between 0(left-justified) and 1(right justified)
        axis.text.y=element_text(size=16, colour="black"),
        axis.title=element_blank(),#text(size=12),#size of the labels on the axes 
        #axis.title.y=element_text(size=12),#size of the labels on the axes
       # axis.title.x=element_blank(),
        #legend.position = c(0.9, 0.9),
        legend.text = element_text(size=16), #
        #legend.title = element_text(),
        strip.text = element_text(size = 16), #font size of facet labels
        strip.background = element_blank() #removes facet label boxes
        )+
  guides(colour = "none", fill = guide_legend(order = 1, title="Temperature"))+ #guide_legend(order = 2, title="Temperature")+
  annotate("text", x=1, y=17.5, label= " ") 
```

```{r}
ggsave(path="Plots", filename="2023-01-27_rETRm_mean-errorSE.png", width=3, height=2)#width=7 or 5
```

```{r}
tapply(PAM.dat$rETRm, PAM.dat$SpeciesLevel, mean)
```

## 7.3 Ik
```{r Ik all data}
FigIkmmeall<-ggplot(PAM.dat_mod2, aes(x=TempLevel, y=Ik, colour=TempLevel, fill=pCO2Level)) # colour needs to be character , colour=TempLevel, fill=TempLevel , fill=SpeciesLevel
FigIkmmeall+
  facet_wrap(.~SpeciesLevel, scales="free_x")+ #, strip.position = "bottom"
  stat_summary(fun=mean, geom="bar", width=0.8, linewidth=1.3, position="dodge")+ # Layer 2: Plot the means as bars , colour="white"  NOTE: requires library(Hmisc) linewidth=0.7,size=10, , colour="black" , fill= "grey70" , fill=c("grey75", "grey50")
  stat_summary(fun.data=mean_se, geom="errorbar", position=position_dodge(width=0.8), width=0.0, colour="black", linetype=1, linewidth=0.8)+# Layer 3: Add CIs as error bars using mean_cl_normal as fun.data 
  scale_y_continuous(breaks=seq(0,100,by=25))+
  scale_colour_manual(values = c("skyblue", "royalblue", "blue3"))+ 
  scale_fill_manual(values = c("white", "grey80"))+  #, labels = expression("...", "...") 
  labs(x="Temperature level", y=expression("I"[k]*" [µmol / (m² * s)]"))+ #labeling of axes expression("I"[k]*" [µmol / (m² * s"^"1"*")]")
  theme(panel.background=element_blank(), #no background
        axis.line.x=element_line(colour="black"), #colour of the x- axis; size= 0.8
        axis.line.y=element_line(colour="black"), #colour of the y- axis; size= 0.8
        axis.ticks.x = element_line(size=0.8), #x axis tick; to include and modify width use element_line(size = 0.8)
        #axis.ticks.length=unit(),#.25, "cm"
        panel.grid=element_blank(), #no grid lines
        axis.text.x=element_text(size=12, colour="black"), #for size of the numbers along the axes; include labels via element_text(size=10, angle=90, hjust=0, vjust=0.25); hjust and vjust are defined between 0(left-justified) and 1(right justified)
        axis.text.y=element_text(size=12, colour="black"),
        axis.title=element_text(size=12),#size of the labels on the axes 
        #axis.title.y=element_text(size=12),#size of the labels on the axes
        #axis.title.x=element_blank(),
        #legend.position = c(0.9, 0.9),
        legend.text = element_text(size=12), #
        #legend.title = element_text(),
        strip.text = element_text(size = 12), #font size of facet labels
        strip.background = element_blank() #removes facet label boxes
        )+
  guides(colour = "none", fill = "none")+ #guide_legend(order = 2, title="Temperature")+
  annotate("text", x=1, y=165, label= " ") 
```
```{r}
ggsave(path="Plots", filename="2023-01-27_Ik_mean-errorSE_all-data.png", width=7, height=4)#width=7 or 5
```


```{r}
FigIkme<-ggplot(PAM.dat_mod2, aes(x=SpeciesLevel, y=Ik)) # colour needs to be character , colour=TempLevel, fill=TempLevel , fill=SpeciesLevel
FigIkme+
  #facet_wrap(.~SpeciesLevel, scales="free_x")+ #, strip.position = "bottom"
  stat_summary(fun=mean, geom="bar", width=0.8, linewidth=1, position="dodge", colour="black", fill="white")+ # Layer 2: Plot the means as bars , colour="white"  NOTE: requires library(Hmisc)
  stat_summary(fun.data=mean_se, geom="errorbar", position=position_dodge(width=0.9), width=0.0, colour="black", linetype=1, linewidth=0.8)+# Layer 3: Add CIs as error bars using mean_cl_normal as fun.data
  #scale_colour_manual(values = c("skyblue", "royalblue", "blue3"))+ 
  #scale_fill_manual(values = c("grey70", "grey90"))+  #, labels = expression("...", "...") 
  labs(x="none", y="none")+ #labeling of axes
  scale_y_continuous(breaks=seq(0,100,by=25))+
  theme(panel.background=element_blank(), #no background
        axis.line.x=element_line(colour="black"), #colour of the x- axis; size= 0.8
        axis.line.y=element_line(colour="black"), #colour of the y- axis; size= 0.8
        axis.ticks.x = element_blank(), #x axis tick; to include and modify width use element_line(size = 0.8)
        #axis.ticks.length=unit(),#.25, "cm"
        panel.grid=element_blank(), #no grid lines
        axis.text.x=element_blank(),#text(size=12), #for size of the numbers along the axes; include labels via element_text(size=10, angle=90, hjust=0, vjust=0.25); hjust and vjust are defined between 0(left-justified) and 1(right justified)
        axis.text.y=element_text(size=16, colour="black"),
        axis.title=element_blank(),#text(size=12),#size of the labels on the axes 
        #axis.title.y=element_text(size=12),#size of the labels on the axes
       # axis.title.x=element_blank(),
        #legend.position = c(0.9, 0.9),
        legend.text = element_text(size=16), #
        #legend.title = element_text(),
        strip.text = element_text(size = 16), #font size of facet labels
        strip.background = element_blank() #removes facet label boxes
        )+
  guides(colour = "none", fill = guide_legend(order = 1, title="Temperature"))+ #guide_legend(order = 2, title="Temperature")+
  annotate("text", x=1, y=95, label= " ") 
```

```{r}
ggsave(path="Plots", filename="2023-01-27_Ik_mean-errorSE.png", width=3, height=2)#width=7 or 5
```

```{r}
tapply(PAM.dat$Ik, PAM.dat$SpeciesLevel, mean)
(87.33053-60.27457)/60.27457 #0.4488785
```




